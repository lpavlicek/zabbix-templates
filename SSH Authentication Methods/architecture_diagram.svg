<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600">
  <!-- Definitions -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#2563eb" />
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#10b981" />
    </marker>
    <filter id="shadow">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/>
    </filter>
  </defs>
  
  <!-- Title -->
  <text x="400" y="30" font-family="Arial, sans-serif" font-size="20" font-weight="bold" text-anchor="middle" fill="#1f2937">
    SSH Authentication Monitoring Architecture
  </text>
  
  <!-- Zabbix Server -->
  <rect x="300" y="80" width="200" height="100" rx="10" fill="#3b82f6" filter="url(#shadow)"/>
  <text x="400" y="115" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="white">
    Zabbix Server
  </text>
  <text x="400" y="140" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="white">
    Template Items
  </text>
  <text x="400" y="160" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="white">
    Triggers &amp; Alerts
  </text>
  
  <!-- External Server -->
  <rect x="50" y="280" width="200" height="120" rx="10" fill="#10b981" filter="url(#shadow)"/>
  <text x="150" y="315" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="white">
    External Server
  </text>
  <text x="150" y="340" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="white">
    Perl Script
  </text>
  <text x="150" y="360" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">
    • ssh_auth_methods.pl
  </text>
  <text x="150" y="380" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">
    • Cron job (every 30 min)
  </text>
  
  <!-- Monitored Hosts -->
  <rect x="550" y="280" width="200" height="120" rx="10" fill="#f59e0b" filter="url(#shadow)"/>
  <text x="650" y="315" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="white">
    Monitored Hosts
  </text>
  <text x="650" y="340" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="white">
    SSH Server (port 22)
  </text>
  <text x="650" y="360" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">
    • Multiple IP addresses
  </text>
  <text x="650" y="380" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">
    • IPv4 &amp; IPv6
  </text>
  
  <!-- DNS Server -->
  <rect x="300" y="480" width="200" height="80" rx="10" fill="#8b5cf6" filter="url(#shadow)"/>
  <text x="400" y="515" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="white">
    DNS Server
  </text>
  <text x="400" y="540" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="white">
    SSHFP Records
  </text>
  
  <!-- Step 1: External to Zabbix (Get hosts with template) -->
  <path d="M 150,280 Q 150,200 300,150" fill="none" stroke="#10b981" stroke-width="2" marker-end="url(#arrowhead-green)"/>
  <text x="180" y="200" font-family="Arial, sans-serif" font-size="11" fill="#1f2937" font-weight="bold">
    ① Get hosts
  </text>
  <text x="180" y="215" font-family="Arial, sans-serif" font-size="10" fill="#6b7280">
    API: host.get
  </text>
  <text x="180" y="228" font-family="Arial, sans-serif" font-size="9" fill="#6b7280">
    (with template)
  </text>
  
  <!-- Step 2: External to Monitored (SSH test) -->
  <line x1="250" y1="340" x2="550" y2="340" stroke="#10b981" stroke-width="2" marker-end="url(#arrowhead-green)"/>
  <text x="400" y="330" font-family="Arial, sans-serif" font-size="11" fill="#1f2937" font-weight="bold">
    ② SSH Connection Test
  </text>
  <text x="400" y="365" font-family="Arial, sans-serif" font-size="10" fill="#6b7280">
    Auth methods detection
  </text>
  
  <!-- Step 3: External to DNS -->
  <line x1="150" y1="400" x2="350" y2="480" stroke="#10b981" stroke-width="2" marker-end="url(#arrowhead-green)"/>
  <text x="220" y="450" font-family="Arial, sans-serif" font-size="11" fill="#1f2937" font-weight="bold">
    ③ DNS Query
  </text>
  <text x="220" y="465" font-family="Arial, sans-serif" font-size="10" fill="#6b7280">
    SSHFP records
  </text>
  
  <!-- Step 4: External to Zabbix (Send results via API) -->
  <path d="M 250,320 Q 280,240 350,180" fill="none" stroke="#10b981" stroke-width="2" marker-end="url(#arrowhead-green)"/>
  <text x="280" y="240" font-family="Arial, sans-serif" font-size="11" fill="#1f2937" font-weight="bold">
    ④ Send JSON
  </text>
  <text x="280" y="255" font-family="Arial, sans-serif" font-size="10" fill="#6b7280">
    API: history.push
  </text>
  
  <!-- Zabbix to Monitored (Port check) -->
  <line x1="500" y1="130" x2="550" y2="320" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="540" y="210" font-family="Arial, sans-serif" font-size="11" fill="#1f2937" font-weight="bold">
    Port 22 Check
  </text>
  <text x="540" y="225" font-family="Arial, sans-serif" font-size="10" fill="#6b7280">
    net.tcp.service
  </text>
  <text x="540" y="238" font-family="Arial, sans-serif" font-size="9" fill="#6b7280">
    (from Zabbix)
  </text>
  
  <!-- Legend -->
  <rect x="20" y="20" width="220" height="45" rx="5" fill="#f3f4f6" stroke="#d1d5db" stroke-width="1"/>
  <text x="30" y="35" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#1f2937">
    Data Flow:
  </text>
  <line x1="30" y1="45" x2="60" y2="45" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="65" y="50" font-family="Arial, sans-serif" font-size="10" fill="#4b5563">
    From Zabbix
  </text>
  <line x1="130" y1="45" x2="160" y2="45" stroke="#10b981" stroke-width="2" marker-end="url(#arrowhead-green)"/>
  <text x="165" y="50" font-family="Arial, sans-serif" font-size="10" fill="#4b5563">
    From External Script
  </text>
  
  <!-- Process flow note -->
  <rect x="20" y="520" width="260" height="60" rx="5" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
  <text x="30" y="540" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#92400e">
    Script Execution Order:
  </text>
  <text x="30" y="555" font-family="Arial, sans-serif" font-size="9" fill="#92400e">
    ① Query Zabbix API for hosts → ② Test SSH auth
  </text>
  <text x="30" y="568" font-family="Arial, sans-serif" font-size="9" fill="#92400e">
    → ③ Check SSHFP DNS → ④ Send results to Zabbix
  </text>
</svg>